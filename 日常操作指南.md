# 日常操作指南（提交 / 发布 / 排错）

本仓库是基于 Jekyll（al-folio）生成的静态站点，并通过 GitHub Actions 自动构建后发布到 GitHub Pages。

## 0. 关键概念（必须先搞清楚）

- **源码分支**：你平时改代码、写文章的分支。当前仓库默认是 `master`（也兼容 `main`）。
- **发布分支**：`gh-pages`，里面是构建出来的静态文件（HTML/CSS/JS），用于 GitHub Pages 托管。
- **自动部署**：每次你把改动 `push` 到 `master`（或 `main`），GitHub Actions 会执行构建并把 `_site` 发布到 `gh-pages`。

相关自动部署配置见：`.github/workflows/deploy.yml`。

## 1. 平时改完如何提交并发布（推荐流程）

在你改完文件后，按下面步骤操作即可：

1) 同步远端最新代码（避免冲突）

```bash
git pull --rebase origin master
```

2) 查看你改了什么

```bash
git status
git diff
```

3) 暂存、提交

```bash
git add -A
git commit -m "一句话描述本次修改"
```

4) 推送到 GitHub（触发自动部署）

```bash
git push origin master
```

5) 去 GitHub 网页确认部署成功

- 进入仓库的 **Actions** 页面
- 找到名为 **Deploy** 的 workflow，确认最新一次运行是绿色 ✅

部署成功后，你的网站会自动更新。

## 2. 写文章/更新页面的常见位置

- 博客文章：`_posts/`（文件名通常形如 `YYYY-MM-DD-xxx.md`）
- 页面：`_pages/`
- 项目展示：`_projects/`
- 数据文件：`_data/`
- 站点配置：`_config.yml`

## 3. 本地预览（推荐用 Docker）

首次启动：

```bash
docker compose up
```

浏览器打开：

- http://localhost:8080

停止：

```bash
docker compose down
```

提示：如果你改了依赖或 Dockerfile，使用：

```bash
docker compose up --build
```

## 4. GitHub Pages 设置检查（只需要做一次）

### 4.1 Actions 写权限（必须）

仓库 Settings → Actions → General → Workflow permissions：

- 选择 **Read and write permissions** 并保存

否则自动部署无法把产物推到 `gh-pages`。

### 4.2 Pages 指向 `gh-pages`

仓库 Settings → Pages → Build and deployment：

- Source：**Deploy from a branch**
- Branch：选择 **gh-pages**，目录选 **/(root)**

## 5. 常见问题与快速排错

### 5.1 `git push origin main` 报错：`src refspec main does not match any`

原因：你本地没有 `main` 分支（当前仓库默认分支是 `master`）。

解决：使用：

```bash
git push origin master
```

或者把分支名统一改成 `main`（见第 6 节）。

### 5.2 网站“没样式 / 图片不显示 / 资源 404”

优先检查 `_config.yml` 的这三个字段：

- `url`
- `baseurl`
- `repository`

如果你是个人主页仓库（仓库名为 `username.github.io`），通常应为：

- `url: https://username.github.io`
- `baseurl:` 留空（但保留这一行）

如果你是项目主页（`https://username.github.io/<repo>/`），则应为：

- `url: https://username.github.io`
- `baseurl: /<repo>/`

### 5.3 Actions 部署失败

去 GitHub → Actions → Deploy → 打开失败的那次运行，常见原因：

- 没开 Actions 写权限（见 4.1）
- 依赖安装失败（Ruby/Node/Python）
- `_config.yml` 或 YAML 语法错误

### 5.4 如何手动触发一次部署

GitHub → Actions → Deploy → Run workflow。

## 6. 可选：把默认分支从 `master` 统一改为 `main`

如果你希望以后都用 `main`，可以执行：

```bash
git branch -m master main
git push -u origin main
git push origin --delete master
```

然后去 GitHub 仓库 Settings → Branches，把默认分支改为 `main`。

注意：改默认分支前，确保没有其它人或自动化依赖 `master`。

